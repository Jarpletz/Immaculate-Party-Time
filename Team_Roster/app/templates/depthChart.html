{% extends "teamContainer.html" %}

{% block teamData %}

<!-- Dropdown to change stat -->
<form method="GET" action="/{{ teamId }}/depthChart">
    <label for="stat">Select Stat: </label>
    <select name="stat" id="stat" onchange="this.form.submit()">
        <option value="percentage" {% if stat == 'percentage' %}selected{% endif %}>Playing Time</option>
        <option value="PA" {% if stat == 'PA' %}selected{% endif %}>Plate Appearances</option>
        <option value="wOBA" {% if stat == 'wOBA' %}selected{% endif %}>wOBA</option>
    </select>
    <input type="hidden" name="year" value="{{ year }}">
</form>
<body>
    <main>
        <div id="stadium-wrapper">
            <div id="stadium">
                <div id="field" class="mowed-grass"></div>
                <div id="pitching-box" class="pitching-box">Pitcher Info</div>
                <div id="first-base" class="base"></div>
                <div id="second-base" class="base"></div>
                <div id="third-base" class="base"></div>
                <div id="home-plate"></div>
                <!-- Additional Field Elements Here -->
            </div>

            <div id="player-boxes">
                {% for position, players in positions_stats.items() %}
                <div class="player-box" id="box-{{ position|lower }}">
                    <div class="position-header">
                        <span class="position-label">{{ position }}</span>
                    </div>
                    <ul>
                        {% for player in players %}
                        <li>
                            {{ player.nameFirst }} {{ player.nameLast }} -
                            {% if stat == 'percentage' %}
                                {{ '%0.1f'|format(player.stat_value) }}%
                            {% elif stat == 'wOBA' %}
                                {{ '%0.3f'|format(player.stat_value) }}
                            {% else %}
                                {{ player.stat_value }}
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endfor %}
            </div>
        </div>
    </main>
</body>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const positionsData = JSON.parse('{{ positions_stats|tojson }}');
        const positionMap = {
            P: "box-pitcher",
            C: "box-catcher",
            "1B": "box-firstbase",
            "2B": "box-secondbase",
            "3B": "box-thirdbase",
            SS: "box-shortstop",
            LF: "box-leftfield",
            CF: "box-centerfield",
            RF: "box-rightfield"
        };

        const playerBoxesContainer = document.getElementById('player-boxes');
        playerBoxesContainer.innerHTML = '';

        // Populate each position's box
        for (const [position, players] of Object.entries(positionsData)) {
            const boxId = positionMap[position];
            const box = document.createElement('div');
            box.id = boxId;
            box.classList.add('player-box');
            const header = document.createElement('div');
            header.classList.add('position-header');
            header.innerHTML = `<span class="position-label">${position}</span>`;
            box.appendChild(header);

            const playerList = document.createElement('ul');
            players.forEach(player => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `${player.nameFirst} ${player.nameLast} - ${getStatValue(player)}`;
                playerList.appendChild(listItem);
            });
            box.appendChild(playerList);
            playerBoxesContainer.appendChild(box);
        }
    });

    function getStatValue(player) {
        const stat = document.getElementById('stat').value;

        let statValue = parseFloat(player.stat_value);

        // Check if the conversion resulted in a valid number
        if (isNaN(statValue)) {
            return 'N/A'; // Return 'N/A' if stat_value is invalid or can't be converted to a number
        }

        if (stat === 'percentage') {
            return `${statValue.toFixed(1)}%`;
        } else if (stat === 'wOBA') {
            return statValue.toFixed(3);
        } else {
            return statValue;
        }
    }
</script>
<h2>Depth Chart Tables</h2>
<h3>Pitching</h3>
<table class="stats-table">
    <thead>
        <tr>
            <th>Name</th>
            <th>IP</th>
            <th>K/9</th>
            <th>BB/9</th>
            <th>HR/9</th>
            <th>BABIP</th>
            <th>LOB%</th>
            <th>ERA</th>
            <th>FIP</th>
        </tr>
    </thead>
    <tbody>
        {% for player_id, pitcher in pitching_stats.items() %}
        <tr>
            <td>{{ pitcher.full_name }}</td>
            <td>{{ '%0.1f'|format(pitcher.IP) }}</td>
            <td>{{ '%0.1f'|format(pitcher.K9) }}</td>
            <td>{{ '%0.1f'|format(pitcher.BB9) }}</td>
            <td>{{ '%0.1f'|format(pitcher.HR9) }}</td>
            <td>{{ '%0.3f'|format(pitcher.BABIP) }}</td>
            <td>{{ '%0.1f'|format(pitcher.LOB * 100) }}%</td>
            <td>{{ '%0.2f'|format(pitcher.ERA) }}</td>
            <td>{{ '%0.2f'|format(pitcher.FIP) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<p>* IP was approximated using IPOuts / 3</p>
{% endblock %}